
use std::time::Duration;

use crate::{
    particles::air::Air,
    utils::{MooreNeighborhood, Vec2},
    world::World,
};
use sdl2::pixels::Color;

use super::particle::{Particle, ParticleBehaviour};

#[derive(Debug, Clone, PartialEq, PartialOrd)]
pub struct Water {}

impl ParticleBehaviour for Water {
    fn tick(
        &self,
        particle: &Particle,
        neighbors: MooreNeighborhood,
    ) -> Option<(Particle, Particle)> {
        let mut pos = particle.position();

        if neighbors.middle_right.is_some()
            && neighbors.middle_right.unwrap().behaviour().color() == Color::CYAN
        {
            pos.x += 1;
            let new_state = Particle::new(pos.x, pos.y, Box::new(Water{}));
            let old_state = Particle::new(particle.position().x, particle.position().y, Box::new(Air{}));
            return Some((new_state, old_state))
        } else if neighbors.middle_left.is_some()
            && neighbors.middle_left.unwrap().color() == Color::CYAN
        {
            pos.x -= 1;
            let new_state = Particle::new(pos.x, pos.y, Box::new(Water{}));
            let old_state = Particle::new(particle.position().x, particle.position().y, Box::new(Air{}));
            return Some((new_state, old_state))
        } else if neighbors.top.is_some()
            && neighbors.top.unwrap().color() == Color::CYAN
        {
            pos.y += 1;
            pos.x += 1;
            let new_state = Particle::new(pos.x, pos.y, Box::new(Sand{}));
            let old_state = Particle::new(particle.position().x, particle.position().y, Box::new(Air{}));
            return Some((new_state, old_state))
        }

        None
    }

    fn color(&self) -> Color {
        Color::YELLOW
    }
}
